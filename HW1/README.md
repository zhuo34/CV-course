# HW1：OpenCV 视频

### 目录

- [任务内容](#任务内容)
- [使用方法](#使用方法)
- [动画设计与实现](#动画设计与实现)
  - [片头](#片头)
  - [简笔画](#简笔画)
  - [Julia 集](#Julia-集)
  - [片尾](#片尾)
- [问题与讨论](#问题与讨论)

### 任务内容

使用 OpenCV 生成视频，其中包含若干段动画，最终将视频保存。

### 使用方法

项目使用 C++ 为开发语言，使用 CMake 构建。

### 动画设计与实现

#### 片头

片头分为两部分。第一部分展示浙大校徽，第二部分展示自我介绍。

画面一，首先从照片中读入浙大校徽，并居中。这一部分使用 `cv::imread` 函数读取图片，并使用 `cv::resize` 函数将校徽缩放为合适的大小 (200, 200)。

画面二，将校徽移至左上角，并在移动过程中适当缩小图标，使其成为之后画面的背景。这一部分首先为动画选定持续时间，在每一帧计算出动画完成的比例 `alpha`，通过 `alpha` 计算该帧所展示的动画。其中每帧首先清除上帧的内容，计算校徽应出现的位置和大小，最后显示出来。

画面三，淡入个人照片以及个人信息。从文件中读取个人照片后，通过 OpenCV 对 `cv::Mat` 关于乘法运算符的重载，对照片进行淡化处理。再应用画面二中控制动画的 `alpha`，实现淡入的效果。文字的展示通过 `cv::putText` 实现。

实现细节见 [`anime_head.cpp`](anime_head.cpp)。

#### 简笔画

简笔画分为三个部分。第一部分是简笔画本身，第二部分是对简笔画的说明，第三部分是转场。

画面一，简笔画。简笔画的主题内容是[曼德博集][曼德博 wiki]。它是一个复数集合，在二维复平面上的图案有很多规律。它最大的图案是中心的心形线。根据其参数方程，很容易实现它的简笔画：将画布表示为一个二维坐标系，通过参数方程逐帧画出心形线的轮廓。过程中使用 `cv::line` 函数，在每一帧的数据点和前一帧之间画一条线段，由此画出轮廓。

> 曼德博集与 Julia 集有相似之处，具体可见下节讨论。

画面二，显示简笔画说明。通过文字的形式，标注出简笔画内容是曼德博集的中心心形图案。文字同样使用淡入的方式实现。

画面三，转场。将目前的白色画布缩至左下角，其他部分展示出下一部分的第一帧。这个动画的实现依赖于 `cv::Mat::copyTo` 函数，即先渲染出下一部分的第一帧，之后讲缩小后的白色画布拷贝到其相应位置。

实现细节见 [`anime_juliaset.cpp`](anime_juliaset.cpp)。

#### Julia 集

[Julia 集][Julia-wiki]是复平面上生成分形的点的集合。它可以通过 $f_c(z) = z^2+c$ 反复迭代得到，某值 $z_0$ 经过迭代可能发散或收敛，根据这个特性可以对不同点染色，最终形成分形图案。不同的 $c$ 的选取对应不同的分形图案。这里，$c$ 选取曼德博集中心心形线上的点，由此可以形成连续变化的分形图案。

这部分动画表现形式是，主画面表示 Julia 集的分形动画，左下角的画布表现当前的 $c$ 在中心心形线上的位置。

由于不同 $z_0$ 分形动画的计算和渲染可并行，项目提供了 CUDA 加速的版本。

实现细节见 [`anime_juliaset.cpp`](anime_juliaset.cpp)。

#### 片尾

片尾模仿电影的片尾。在黑色画幕上，不同信息自下而上连续滚动。滚动的实现通过改变文字渲染的位置实现，即每帧按照预设的速度，计算出该帧文字的位置并调用 `cv::putText`。其中在水平方向需要将字幕居中，这个实现通过 `cv::getTextSize` 获取文字渲染的大小，随后计算出文字居中时文字框左下角的水平位置。

在滚动过程中，根据垂直方向的位置，动态地调整文字的亮度。这里使用一个正太分布，靠近中间的字幕较亮，两侧的字幕较暗。

最后，将结束语跟随字幕升起，并在屏幕中间位置停下，等待之前字幕滚动完成后结束视频。

实现细节见 [`anime_tail.cpp`](anime_tail.cpp)。

### 问题与讨论

元素的移动仅使用了匀速移动，没有考虑加速度，导致移动不够自然，不够顺滑，不够高级。

[曼德博集 wiki]: https://zh.wikipedia.org/wiki/曼德博集合
[曼德博集图片]: imgs/Mandelset.png
[Julia-wiki]: https://zh.wikipedia.org/wiki/朱利亚集合

